<!DOCTYPE html>
<html>
<head>
    <title>Tally Bills App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; }
        .list-group-item { display: flex; justify-content: space-between; align-items: center; }
        .amount { font-weight: bold; }
        .tab-btn { width: 48%; }
    </style>
</head>
<body class="p-3">

    <h4 class="mb-3 text-center">My Outstanding Bills</h4>
    
    <div class="d-flex justify-content-between mb-3">
        <button class="btn btn-success tab-btn" onclick="showSection('receivable')">To Receive (In)</button>
        <button class="btn btn-danger tab-btn" onclick="showSection('payable')">To Pay (Out)</button>
    </div>

    <div id="receivable-section">
        <h6 class="text-success">Who owes you money:</h6>
        <ul class="list-group" id="receivable-list">
            <li class="list-group-item text-muted">Loading...</li>
        </ul>
    </div>

    <div id="payable-section" style="display:none;">
        <h6 class="text-danger">Who you need to pay:</h6>
        <ul class="list-group" id="payable-list">
             <li class="list-group-item text-muted">Loading...</li>
        </ul>
    </div>

    <p class="text-center mt-3 text-muted small" id="lastTime"></p>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // PASTE FIREBASE CONFIG HERE
        const firebaseConfig = {
              apiKey: "AIzaSyCW6QMHok6SU-PkmMMEKF65ob_anT08tzc",
  authDomain: "tallyconnect-7b4eb.firebaseapp.com",
  projectId: "tallyconnect-7b4eb",
  storageBucket: "tallyconnect-7b4eb.firebasestorage.app",
  messagingSenderId: "134855390523",
  appId: "1:134855390523:web:77a46a09a0f82a7a05b31e"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Function to Create List Items HTML
        function renderList(items, elementId, colorClass) {
            const list = document.getElementById(elementId);
            list.innerHTML = ""; // Clear old data
            
            if(items.length === 0) {
                list.innerHTML = "<li class='list-group-item'>No outstanding bills.</li>";
                return;
            }

            items.forEach(party => {
                const li = document.createElement("li");
                li.className = "list-group-item";
                li.innerHTML = `
                    <span>${party.name}</span>
                    <span class="amount ${colorClass}">â‚¹ ${party.amount.toLocaleString()}</span>
                `;
                list.appendChild(li);
            });
        }

        // Real-time Listener
        onSnapshot(doc(db, "companies", "client_001"), (doc) => {
            if (doc.exists()) {
                const data = doc.data();
                renderList(data.receivables, "receivable-list", "text-success");
                renderList(data.payables, "payable-list", "text-danger");
                
                const time = data.lastUpdated ? data.lastUpdated.toDate().toLocaleTimeString() : "";
                document.getElementById("lastTime").innerText = "Synced: " + time;
            }
        });

        // Simple Tab Switcher
        window.showSection = (type) => {
            if(type === 'receivable') {
                document.getElementById('receivable-section').style.display = 'block';
                document.getElementById('payable-section').style.display = 'none';
            } else {
                document.getElementById('receivable-section').style.display = 'none';
                document.getElementById('payable-section').style.display = 'block';
            }
        }
    </script>
</body>
</html>